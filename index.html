<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Последние 5 цен SBER</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { margin-bottom: 15px; }
    ul { background: white; padding: 15px; border-radius: 8px; max-width: 300px; }
    li { padding: 5px 0; font-size: 18px; }
  </style>
</head>
<body>
  <h2>Последние 5 цен закрытия акции SBER (с 2020)</h2>
  <ul id="prices">
    <li>Загрузка...</li>
  </ul>

  <script>
    async function fetchRecentPrices(ticker) {
      const fromDate = '2020-01-01';
      const url = `https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/${ticker}/candles.json?interval=24&from=${fromDate}&sort_order=asc&limit=100`;

      try {
        const res = await fetch(url);
        const json = await res.json();

        const columns = json.candles.columns;
        const data = json.candles.data;

        if (!data || data.length === 0) {
          throw new Error('Данные не найдены');
        }

        const dateIndex = columns.indexOf("begin");
        const closeIndex = columns.indexOf("close");

        // Возьмём последние 5 записей из полученных данных
        const last5 = data.slice(-5);

        return last5.map(row => ({
          date: row[dateIndex].split('T')[0],
          close: row[closeIndex]
        }));

      } catch (e) {
        console.error(e);
        return null;
      }
    }

    async function showPrices() {
      const ul = document.getElementById('prices');
      ul.innerHTML = '<li>Загрузка...</li>';

      const prices = await fetchRecentPrices('SBER');

      if (!prices) {
        ul.innerHTML = '<li>Ошибка загрузки данных</li>';
        return;
      }

      ul.innerHTML = prices.map(p => `<li>${p.date}: ${p.close} ₽</li>`).join('');
    }

    showPrices();
  </script>
</body>
</html>
