<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Актуальная цена акции</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 30px;
      background: #f5f5f5;
    }
    h2 {
      margin-bottom: 20px;
    }
    #price {
      font-size: 28px;
      color: #2e7d32;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Цена акции <span id="ticker-label">AAPL</span> (в реальном времени)</h2>
  <div id="price">Загрузка...</div>

  <script>
    async function fetchLivePrice(ticker) {
      const proxy = 'https://api.allorigins.win/get?url=';
      const url = `https://finance.yahoo.com/quote/${ticker}`;
      const fullUrl = proxy + encodeURIComponent(url);

      try {
        const res = await fetch(fullUrl);
        const data = await res.json();
        const html = data.contents;

        // Найдём цену из <fin-streamer data-field="regularMarketPrice">
        const match = html.match(/<fin-streamer[^>]+data-field="regularMarketPrice"[^>]*>([\d.,]+)<\/fin-streamer>/);
        const price = match ? match[1] : null;

        if (price) {
          document.getElementById('price').textContent = `$${price}`;
        } else {
          document.getElementById('price').textContent = 'Цена не найдена';
        }
      } catch (error) {
        console.error('Ошибка при загрузке:', error);
        document.getElementById('price').textContent = 'Ошибка загрузки';
      }
    }

    const ticker = 'AAPL';
    document.getElementById('ticker-label').textContent = ticker;
    fetchLivePrice(ticker);
  </script>
</body>
</html>
